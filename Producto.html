<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta content="width=device-width, initial-scale=1.0" name="viewport">

  <title>Presentación - SignEase</title>
  <meta content="" name="description">
  <meta content="" name="keywords">

  <!-- Favicons -->
  <link href="assets/img/Logo-SignEase.png" rel="icon">
  <link href="assets/img/Logo-SignEase.png" rel="apple-touch-icon">

  <!-- Google Fonts -->
  <link
    href="https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,600,600i,700,700i|Raleway:300,300i,400,400i,500,500i,600,600i,700,700i|Poppins:300,300i,400,400i,500,500i,600,600i,700,700i"
    rel="stylesheet">

  <!-- Vendor CSS Files -->
  <link href="assets/vendor/aos/aos.css" rel="stylesheet">
  <link href="assets/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
  <link href="assets/vendor/bootstrap-icons/bootstrap-icons.css" rel="stylesheet">
  <link href="assets/vendor/boxicons/css/boxicons.min.css" rel="stylesheet">
  <link href="assets/vendor/glightbox/css/glightbox.min.css" rel="stylesheet">
  <link href="assets/vendor/swiper/swiper-bundle.min.css" rel="stylesheet">

  <!-- Template Main CSS File -->
  <link href="assets/css/style.css" rel="stylesheet">


  <link href="registration/css/style.css" rel="stylesheet">
  <style>
    #video {
      /* Voltea horizontalmente el video */
      transform: scaleX(-1);
      -webkit-transform: scaleX(-1); /* Safari y Chrome */
      -moz-transform: scaleX(-1); /* Firefox */
      -ms-transform: scaleX(-1); /* IE 9 */
      -o-transform: scaleX(-1); /* Opera */
    }

    .canva{
      transform: scaleX(-1);
      top: -255px;
      left: 13px;
      position: relative;
      width: 335px;
      height: 250px;
    }
  </style>

  <!-- TensorFlow.js Library -->
  <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@latest"></script>
  <!-- HandPose model plugin -->
  <script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/handpose@latest"></script>
  
</head>

<body>

  <!-- ======= Header ======= -->
  <header id="header">
    <div class="container d-flex align-items-center justify-content-between">
      <div class="logo">
        <a href="index.html"><img src="assets/img/Logo-H-SignEase.png" alt="" class="img-fluid"></a>
      </div>

      <nav id="navbar" class="navbar">
        <ul>
          <li><a class="nav-link scrollto" href="#">Fernando Vargas</a></li>
          <li><a class="getstarted scrollto" href="index.html">Log Out</a></li>
        </ul>
        <i class="bi bi-list mobile-nav-toggle"></i>
      </nav><!-- .navbar -->

    </div>
  </header><!-- End Header -->

  <main id="main">
    <section class="inner-page">
      <div class="row">
        <div class="col-lg-9">
          <div class="container">
            <div id="carouselExampleIndicators" class="carousel slide" data-ride="carousel">
              <div class="carousel-inner">
                <div class="carousel-item active">
                  <img src="assets/img/slides/1.png" class="d-block w-100" alt="Slide 1">
                </div>
                <div class="carousel-item">
                  <img src="assets/img/slides/2.png" class="d-block w-100" alt="Slide 2">
                </div>
                <div class="carousel-item">
                  <img src="assets/img/slides/3.png" class="d-block w-100" alt="Slide 2">
                </div>
                <div class="carousel-item">
                  <img src="assets/img/slides/4.png" class="d-block w-100" alt="Slide 2">
                </div>
              </div>
              <a class="carousel-control-prev" href="#carouselExampleIndicators" role="button" data-slide="prev">
                <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                <span class="sr-only"></span>
              </a>
              <a class="carousel-control-next" href="#carouselExampleIndicators" role="button" data-slide="next">
                <span class="carousel-control-next-icon" aria-hidden="true"></span>
                <span class="sr-only"></span>
              </a>
            </div>
          </div>
        </div>
        <div class="col-lg-3">
          <div class="row">
            <div class="col-lg-12 col-6">
              <video autoplay loop muted style="width: 100%; height: 188px;">
                <source src="assets/video/Modelo.mp4" type="video/mp4">
              </video>
            </div>
            <div class="col-lg-12 col-6">
              <video id="video" width="100%" height="250" autoplay></video>
              <canvas id="canvas" class="canva"></canvas>
            </div>
          </div>
        </div>
      </div>
    </section>

  </main><!-- End #main -->

   <!-- ======= Footer ======= -->
   <footer id="footer">

    <div class="footer-top">

      <div class="container">

        <div class="row  justify-content-center">
          <div class="col-lg-6">
            <h3>SignEase</h3>
            <p>Suscribete para informarte de los avances del proyecto, promociones y mucho más.</p>
          </div>
        </div>

        <div class="row footer-newsletter justify-content-center">
          <div class="col-lg-6">
            <form action="" method="post">
              <input type="email" name="email" placeholder="Enter your Email"><input type="submit" value="Subscribe">
            </form>
          </div>
        </div>

        <div class="social-links">
          <a href="#" class="twitter"><i class="bx bxl-twitter"></i></a>
          <a href="#" class="facebook"><i class="bx bxl-facebook"></i></a>
          <a href="#" class="instagram"><i class="bx bxl-instagram"></i></a>
          <a href="#" class="linkedin"><i class="bx bxl-linkedin"></i></a>
        </div>

      </div>
    </div>

    <div class="container footer-bottom clearfix">
      <div class="copyright">
        &copy; Copyright <strong><span>UnityClass</span></strong>. All Rights Reserved
      </div>
      <div class="credits">
        Designed by <a href="#">UnityClass</a>
      </div>
    </div>
  </footer><!-- End Footer -->

  <a href="#" class="back-to-top d-flex align-items-center justify-content-center"><i
      class="bi bi-arrow-up-short"></i></a>

  <!-- Vendor JS Files -->
  <script src="assets/vendor/aos/aos.js"></script>
  <script src="assets/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
  <script src="assets/vendor/glightbox/js/glightbox.min.js"></script>
  <script src="assets/vendor/isotope-layout/isotope.pkgd.min.js"></script>
  <script src="assets/vendor/swiper/swiper-bundle.min.js"></script>
  <script src="assets/vendor/php-email-form/validate.js"></script>

  <!-- Template Main JS File -->
  <script src="assets/js/main.js"></script>

  <script src="registration/js/jquery-3.3.1.min.js"></script>
	<script src="registration/js/jquery.steps.js"></script>
	<script src="registration/js/main.js"></script>
  <script>
    let initialX = null; // Posición X inicial de la mano

    // Asegúrate de que checkIfFistIsClosed esté definida en un alcance accesible para detectHands
    function checkIfFistIsClosed(keypoints) {
      const wrist = keypoints[0];
      const indexFingerTip = keypoints[8]; // Punta del dedo índice
      const middleFingerTip = keypoints[12]; // Punta del dedo medio
      const ringFingerTip = keypoints[16]; // Punta del dedo anular
      const pinkyFingerTip = keypoints[20]; // Punta del dedo meñique

      // Calcula la altura relativa de la punta del dedo índice respecto a la muñeca
      const indexFingerHeight = wrist[1] - indexFingerTip[1];

      // Realiza lo mismo para los otros dedos
      const middleFingerHeight = wrist[1] - middleFingerTip[1];
      const ringFingerHeight = wrist[1] - ringFingerTip[1];
      const pinkyFingerHeight = wrist[1] - pinkyFingerTip[1];

      // Define un umbral para considerar que un dedo está "levantado"
      const upThreshold = 120; // Ajusta este valor según tus pruebas

      // Verifica si el dedo índice está levantado significativamente más alto que los otros dedos
      return (
          indexFingerHeight > upThreshold &&
          middleFingerHeight < upThreshold &&
          ringFingerHeight < upThreshold &&
          pinkyFingerHeight < upThreshold
      );
    }

    // Definición única de detectHands fuera de main.
    async function detectHands(model, video, canvas, ctx) {
      const predictions = await model.estimateHands(video);
      
      // Limpia el canvas anterior
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      
      if (predictions.length > 0) {
        const keypoints = predictions[0].landmarks;
        const handX = keypoints[0][0]; // Definimos handX usando la base de la palma

          // Escala y dibuja cada punto clave
        keypoints.forEach(([x, y]) => {
          // Escala las coordenadas de los puntos de seguimiento
          const scaledX = x * (canvas.width / video.videoWidth);
          const scaledY = y * (canvas.height / video.videoHeight);

          ctx.beginPath();
          ctx.arc(scaledX, scaledY, 5, 0, 2 * Math.PI);
          ctx.fillStyle = "red";
          ctx.fill();
        });

        // Determina si la mano está cerrada
        const isFistClosed = checkIfFistIsClosed(keypoints);
        if (isFistClosed) {
          if(initialX === null) {
            initialX = handX; // Establece la posición inicial si aún no se ha establecido
          } else {
            const movementThreshold = 50; // Define un umbral para el movimiento
            const deltaX = handX - initialX;
            
            if(Math.abs(deltaX) > movementThreshold) {
              if(deltaX > 0) {
                // Movimiento hacia la derecha
                $('#carouselExampleIndicators').carousel('next');
              } else {
                // Movimiento hacia la izquierda
                $('#carouselExampleIndicators').carousel('prev');
              }
              initialX = handX; // Actualiza la posición inicial después de detectar un movimiento
            }
          }
        }
      } else {
        initialX = null; // Resetea la posición inicial si no se detectan manos
      }

      // Llamar a detectHands de nuevo para crear un bucle
      requestAnimationFrame(() => {
        detectHands(model, video, canvas, ctx);
      });
    }
    
    async function main() {
      const video = document.getElementById('video');
      const canvas = document.getElementById('canvas');
      const ctx = canvas.getContext('2d');
      const model = await handpose.load();
      console.log("Handpose model loaded");

      // Ajusta el tamaño del canvas para que coincida con el del video
      function adjustCanvasSize() {
        canvas.width = video.offsetWidth;
        canvas.height = video.offsetHeight;
      }

      // Iniciar la cámara
      navigator.mediaDevices.getUserMedia({ video: true })
        .then((stream) => {
          video.srcObject = stream;
          video.addEventListener('loadedmetadata', adjustCanvasSize);
          video.addEventListener('loadeddata', async () => {
            console.log("Video stream loaded");
            // Detectar manos constantemente
            detectHands(model, video, canvas, ctx);
          });
        });
    }
    
    main();
  </script>  
</body>

</html>